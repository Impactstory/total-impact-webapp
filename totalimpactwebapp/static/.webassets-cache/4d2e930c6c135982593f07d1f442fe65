/*!
 ICanHaz.js version 0.10.1 -- by @HenrikJoreteg
 More info at: http://icanhazjs.com
 */
(function(){var a=function(){var b=Object.prototype.toString;Array.isArray=Array.isArray||function(k){return b.call(k)=="[object Array]"};var j=String.prototype.trim,c;if(j){c=function(k){return k==null?"":j.call(k)}}else{var d,h;if((/\S/).test("\xA0")){d=/^[\s\xA0]+/;h=/[\s\xA0]+$/}else{d=/^\s+/;h=/\s+$/}c=function(k){return k==null?"":k.toString().replace(d,"").replace(h,"")}}var g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function i(k){return String(k).replace(/&(?!\w+;)|[<>"']/g,function(l){return g[l]||l})}var f={};var e=function(){};e.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(n,m,l,o){if(!o){this.context=m;this.buffer=[]}if(!this.includes("",n)){if(o){return n}else{this.send(n);return}}n=this.render_pragmas(n);var k=this.render_section(n,m,l);if(k===false){k=this.render_tags(n,m,l,o)}if(o){return k}else{this.sendLines(k)}},send:function(k){if(k!==""){this.buffer.push(k)}},sendLines:function(m){if(m){var k=m.split("\n");for(var l=0;l<k.length;l++){this.send(k[l])}}},render_pragmas:function(k){if(!this.includes("%",k)){return k}var m=this;var l=this.getCachedRegex("render_pragmas",function(o,n){return new RegExp(o+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+n,"g")});return k.replace(l,function(p,n,o){if(!m.pragmas_implemented[n]){throw ({message:"This implementation of mustache doesn't understand the '"+n+"' pragma"})}m.pragmas[n]={};if(o){var q=o.split("=");m.pragmas[n][q[0]]=q[1]}return""})},render_partial:function(k,m,l){k=c(k);if(!l||l[k]===undefined){throw ({message:"unknown_partial '"+k+"'"})}if(!m||typeof m[k]!="object"){return this.render(l[k],m,l,true)}return this.render(l[k],m[k],l,true)},render_section:function(m,l,k){if(!this.includes("#",m)&&!this.includes("^",m)){return false}var o=this;var n=this.getCachedRegex("render_section",function(q,p){return new RegExp("^([\\s\\S]*?)"+q+"(\\^|\\#)\\s*(.+)\\s*"+p+"\n*([\\s\\S]*?)"+q+"\\/\\s*\\3\\s*"+p+"\\s*([\\s\\S]*)$","g")});return m.replace(n,function(s,w,v,r,t,q){var y=w?o.render_tags(w,l,k,true):"",u=q?o.render(q,l,k,true):"",p,x=o.find(r,l);if(v==="^"){if(!x||Array.isArray(x)&&x.length===0){p=o.render(t,l,k,true)}else{p=""}}else{if(v==="#"){if(Array.isArray(x)){p=o.map(x,function(z){return o.render(t,o.create_context(z),k,true)}).join("")}else{if(o.is_object(x)){p=o.render(t,o.create_context(x),k,true)}else{if(typeof x=="function"){p=x.call(l,t,function(z){return o.render(z,l,k,true)})}else{if(x){p=o.render(t,l,k,true)}else{p=""}}}}}}return y+p+u})},render_tags:function(s,k,m,o){var n=this;var r=function(){return n.getCachedRegex("render_tags",function(v,u){return new RegExp(v+"(=|!|>|&|\\{|%)?([^#\\^]+?)\\1?"+u+"+","g")})};var p=r();var q=function(w,u,v){switch(u){case"!":return"";case"=":n.set_delimiters(v);p=r();return"";case">":return n.render_partial(v,k,m);case"{":case"&":return n.find(v,k);default:return i(n.find(v,k))}};var t=s.split("\n");for(var l=0;l<t.length;l++){t[l]=t[l].replace(p,q,this);if(!o){this.send(t[l])}}if(o){return t.join("\n")}},set_delimiters:function(l){var k=l.split(" ");this.otag=this.escape_regex(k[0]);this.ctag=this.escape_regex(k[1])},escape_regex:function(l){if(!arguments.callee.sRE){var k=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+k.join("|\\")+")","g")}return l.replace(arguments.callee.sRE,"\\$1")},find:function(m,n){m=c(m);function l(p){return p===false||p===0||p}var o;if(m.match(/([a-z_]+)\./ig)){var k=this.walk_context(m,n);if(l(k)){o=k}}else{if(l(n[m])){o=n[m]}else{if(l(this.context[m])){o=this.context[m]}}}if(typeof o=="function"){return o.apply(n)}if(o!==undefined){return o}return""},walk_context:function(k,l){var o=k.split(".");var n=(l[o[0]]!=undefined)?l:this.context;var m=n[o.shift()];while(m!=undefined&&o.length>0){n=m;m=m[o.shift()]}if(typeof m=="function"){return m.apply(n)}return m},includes:function(l,k){return k.indexOf(this.otag+l)!=-1},create_context:function(l){if(this.is_object(l)){return l}else{var m=".";if(this.pragmas["IMPLICIT-ITERATOR"]){m=this.pragmas["IMPLICIT-ITERATOR"].iterator}var k={};k[m]=l;return k}},is_object:function(k){return k&&typeof k=="object"},map:function(p,n){if(typeof p.map=="function"){return p.map(n)}else{var o=[];var k=p.length;for(var m=0;m<k;m++){o.push(n(p[m]))}return o}},getCachedRegex:function(l,o){var n=f[this.otag];if(!n){n=f[this.otag]={}}var k=n[this.ctag];if(!k){k=n[this.ctag]={}}var m=k[l];if(!m){m=k[l]=o(this.otag,this.ctag)}return m}};return({name:"mustache.js",version:"0.4.0",to_html:function(m,k,l,o){var n=new e();if(o){n.send=o}n.render(m,k||{},l);if(!o){return n.buffer.join("\n")}}})}();
/*!
     ICanHaz.js -- by @HenrikJoreteg
     */
(function(){function b(e){if("".trim){return e.trim()}else{return e.replace(/^\s+/,"").replace(/\s+$/,"")}}var c={VERSION:"0.10.1",templates:{},$:(typeof window!=="undefined")?window.jQuery||window.Zepto||null:null,addTemplate:function(e,g){if(typeof e==="object"){for(var f in e){this.addTemplate(f,e[f])}return}if(c[e]){console.error("Invalid name: "+e+".")}else{if(c.templates[e]){console.error('Template "'+e+'  " exists')}else{c.templates[e]=g;c[e]=function(j,i){j=j||{};var h=a.to_html(c.templates[e],j,c.templates);return(c.$&&!i)?c.$(h):h}}}},clearAll:function(){for(var e in c.templates){delete c[e]}c.templates={}},refresh:function(){c.clearAll();c.grabTemplates()},grabTemplates:function(){var j,f,e=document.getElementsByTagName("script"),g,h=[];for(j=0,f=e.length;j<f;j++){g=e[j];if(g&&g.innerHTML&&g.id&&(g.type==="text/html"||g.type==="text/x-icanhaz")){c.addTemplate(g.id,b(g.innerHTML));h.unshift(g)}}for(j=0,f=h.length;j<f;j++){h[j].parentNode.removeChild(h[j])}}};if(typeof require!=="undefined"){module.exports=c}else{window.ich=c}if(typeof document!=="undefined"){if(c.$){c.$(function(){c.grabTemplates()})}else{var d=function(){c.grabTemplates()};if(document.addEventListener){document.addEventListener("DOMContentLoaded",d,true)}else{if(document.attachEvent){document.attachEvent("DOMContentLoaded",d)}}}}})()})();!function(b){var a=function(d,c){this.init("tooltip",d,c)};a.prototype={constructor:a,init:function(f,e,d){var g,c;this.type=f;this.$element=b(e);this.options=this.getOptions(d);this.enabled=true;if(this.options.trigger=="click"){this.$element.on("click."+this.type,this.options.selector,b.proxy(this.toggle,this))}else{if(this.options.trigger!="manual"){g=this.options.trigger=="hover"?"mouseenter":"focus";c=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(g+"."+this.type,this.options.selector,b.proxy(this.enter,this));this.$element.on(c+"."+this.type,this.options.selector,b.proxy(this.leave,this))}}this.options.selector?(this._options=b.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=b.extend({},b.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show){return c.show()}clearTimeout(this.timeout);c.hoverState="in";this.timeout=setTimeout(function(){if(c.hoverState=="in"){c.show()}},c.options.delay.show)},leave:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(this.timeout){clearTimeout(this.timeout)}if(!c.options.delay||!c.options.delay.hide){return c.hide()}c.hoverState="out";this.timeout=setTimeout(function(){if(c.hoverState=="out"){c.hide()}},c.options.delay.hide)},show:function(){var g,c,i,e,h,d,f;if(this.hasContent()&&this.enabled){g=this.tip();this.setContent();if(this.options.animation){g.addClass("fade")}d=typeof this.options.placement=="function"?this.options.placement.call(this,g[0],this.$element[0]):this.options.placement;c=/in/.test(d);g.remove().css({top:0,left:0,display:"block"}).appendTo(c?this.$element:document.body);i=this.getPosition(c);e=g[0].offsetWidth;h=g[0].offsetHeight;switch(c?d.split(" ")[1]:d){case"bottom":f={top:i.top+i.height,left:i.left+i.width/2-e/2};break;case"top":f={top:i.top-h,left:i.left+i.width/2-e/2};break;case"left":f={top:i.top+i.height/2-h/2,left:i.left-e};break;case"right":f={top:i.top+i.height/2-h/2,left:i.left+i.width};break}g.css(f).addClass(d).addClass("in")}},setContent:function(){var d=this.tip(),c=this.getTitle();d.find(".tooltip-inner")[this.options.html?"html":"text"](c);d.removeClass("fade in top bottom left right")},hide:function(){var c=this,d=this.tip();d.removeClass("in");function e(){var f=setTimeout(function(){d.off(b.support.transition.end).remove()},500);d.one(b.support.transition.end,function(){clearTimeout(f);d.remove()})}b.support.transition&&this.$tip.hasClass("fade")?e():d.remove();return this},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return b.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,c=this.$element,d=this.options;e=c.attr("data-original-title")||(typeof d.title=="function"?d.title.call(c[0]):d.title);return e},tip:function(){return this.$tip=this.$tip||b(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};b.fn.tooltip=function(c){return this.each(function(){var f=b(this),e=f.data("tooltip"),d=typeof c=="object"&&c;if(!e){f.data("tooltip",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.tooltip.Constructor=a;b.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:true}}(jQuery);!function(b){var a=function(d,c){this.init("popover",d,c)};a.prototype=b.extend({},b.fn.tooltip.Constructor.prototype,{constructor:a,setContent:function(){var e=this.tip(),d=this.getTitle(),c=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](d);e.find(".popover-content > *")[this.options.html?"html":"text"](c);e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var d,c=this.$element,e=this.options;d=c.attr("data-content")||(typeof e.content=="function"?e.content.call(c[0]):e.content);return d},tip:function(){if(!this.$tip){this.$tip=b(this.options.template)}return this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});b.fn.popover=function(c){return this.each(function(){var f=b(this),e=f.data("popover"),d=typeof c=="object"&&c;if(!e){f.data("popover",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.popover.Constructor=a;b.fn.popover.defaults=b.extend({},b.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(jQuery);(function(){var w=this;var k=w._;var D={};var C=Array.prototype,f=Object.prototype,r=Function.prototype;var H=C.push,o=C.slice,y=C.concat,d=f.toString,j=f.hasOwnProperty;var L=C.forEach,q=C.map,E=C.reduce,c=C.reduceRight,b=C.filter,B=C.every,p=C.some,n=C.indexOf,l=C.lastIndexOf,u=Array.isArray,e=Object.keys,F=r.bind;var M=function(N){if(N instanceof M){return N}if(!(this instanceof M)){return new M(N)}this._wrapped=N};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=M}exports._=M}else{w._=M}M.VERSION="1.4.3";var I=M.each=M.forEach=function(S,R,Q){if(S==null){return}if(L&&S.forEach===L){S.forEach(R,Q)}else{if(S.length===+S.length){for(var P=0,N=S.length;P<N;P++){if(R.call(Q,S[P],P,S)===D){return}}}else{for(var O in S){if(M.has(S,O)){if(R.call(Q,S[O],O,S)===D){return}}}}}};M.map=M.collect=function(Q,P,O){var N=[];if(Q==null){return N}if(q&&Q.map===q){return Q.map(P,O)}I(Q,function(T,R,S){N[N.length]=P.call(O,T,R,S)});return N};var g="Reduce of empty array with no initial value";M.reduce=M.foldl=M.inject=function(R,Q,N,P){var O=arguments.length>2;if(R==null){R=[]}if(E&&R.reduce===E){if(P){Q=M.bind(Q,P)}return O?R.reduce(Q,N):R.reduce(Q)}I(R,function(U,S,T){if(!O){N=U;O=true}else{N=Q.call(P,N,U,S,T)}});if(!O){throw new TypeError(g)}return N};M.reduceRight=M.foldr=function(T,Q,N,P){var O=arguments.length>2;if(T==null){T=[]}if(c&&T.reduceRight===c){if(P){Q=M.bind(Q,P)}return O?T.reduceRight(Q,N):T.reduceRight(Q)}var S=T.length;if(S!==+S){var R=M.keys(T);S=R.length}I(T,function(W,U,V){U=R?R[--S]:--S;if(!O){N=T[U];O=true}else{N=Q.call(P,N,T[U],U,V)}});if(!O){throw new TypeError(g)}return N};M.find=M.detect=function(Q,P,O){var N;A(Q,function(T,R,S){if(P.call(O,T,R,S)){N=T;return true}});return N};M.filter=M.select=function(Q,P,O){var N=[];if(Q==null){return N}if(b&&Q.filter===b){return Q.filter(P,O)}I(Q,function(T,R,S){if(P.call(O,T,R,S)){N[N.length]=T}});return N};M.reject=function(P,O,N){return M.filter(P,function(S,Q,R){return !O.call(N,S,Q,R)},N)};M.every=M.all=function(Q,P,O){P||(P=M.identity);var N=true;if(Q==null){return N}if(B&&Q.every===B){return Q.every(P,O)}I(Q,function(T,R,S){if(!(N=N&&P.call(O,T,R,S))){return D}});return !!N};var A=M.some=M.any=function(Q,P,O){P||(P=M.identity);var N=false;if(Q==null){return N}if(p&&Q.some===p){return Q.some(P,O)}I(Q,function(T,R,S){if(N||(N=P.call(O,T,R,S))){return D}});return !!N};M.contains=M.include=function(O,N){if(O==null){return false}if(n&&O.indexOf===n){return O.indexOf(N)!=-1}return A(O,function(P){return P===N})};M.invoke=function(O,P){var N=o.call(arguments,2);return M.map(O,function(Q){return(M.isFunction(P)?P:Q[P]).apply(Q,N)})};M.pluck=function(O,N){return M.map(O,function(P){return P[N]})};M.where=function(O,N){if(M.isEmpty(N)){return[]}return M.filter(O,function(Q){for(var P in N){if(N[P]!==Q[P]){return false}}return true})};M.max=function(Q,P,O){if(!P&&M.isArray(Q)&&Q[0]===+Q[0]&&Q.length<65535){return Math.max.apply(Math,Q)}if(!P&&M.isEmpty(Q)){return -Infinity}var N={computed:-Infinity,value:-Infinity};I(Q,function(U,R,T){var S=P?P.call(O,U,R,T):U;S>=N.computed&&(N={value:U,computed:S})});return N.value};M.min=function(Q,P,O){if(!P&&M.isArray(Q)&&Q[0]===+Q[0]&&Q.length<65535){return Math.min.apply(Math,Q)}if(!P&&M.isEmpty(Q)){return Infinity}var N={computed:Infinity,value:Infinity};I(Q,function(U,R,T){var S=P?P.call(O,U,R,T):U;S<N.computed&&(N={value:U,computed:S})});return N.value};M.shuffle=function(Q){var P;var O=0;var N=[];I(Q,function(R){P=M.random(O++);N[O-1]=N[P];N[P]=R});return N};var a=function(N){return M.isFunction(N)?N:function(O){return O[N]}};M.sortBy=function(Q,P,N){var O=a(P);return M.pluck(M.map(Q,function(T,R,S){return{value:T,index:R,criteria:O.call(N,T,R,S)}}).sort(function(U,T){var S=U.criteria;var R=T.criteria;if(S!==R){if(S>R||S===void 0){return 1}if(S<R||R===void 0){return -1}}return U.index<T.index?-1:1}),"value")};var t=function(S,R,O,Q){var N={};var P=a(R||M.identity);I(S,function(V,T){var U=P.call(O,V,T,S);Q(N,U,V)});return N};M.groupBy=function(P,O,N){return t(P,O,N,function(Q,R,S){(M.has(Q,R)?Q[R]:(Q[R]=[])).push(S)})};M.countBy=function(P,O,N){return t(P,O,N,function(Q,R){if(!M.has(Q,R)){Q[R]=0}Q[R]++})};M.sortedIndex=function(U,T,Q,P){Q=Q==null?M.identity:a(Q);var S=Q.call(P,T);var N=0,R=U.length;while(N<R){var O=(N+R)>>>1;Q.call(P,U[O])<S?N=O+1:R=O}return N};M.toArray=function(N){if(!N){return[]}if(M.isArray(N)){return o.call(N)}if(N.length===+N.length){return M.map(N,M.identity)}return M.values(N)};M.size=function(N){if(N==null){return 0}return(N.length===+N.length)?N.length:M.keys(N).length};M.first=M.head=M.take=function(P,O,N){if(P==null){return void 0}return(O!=null)&&!N?o.call(P,0,O):P[0]};M.initial=function(P,O,N){return o.call(P,0,P.length-((O==null)||N?1:O))};M.last=function(P,O,N){if(P==null){return void 0}if((O!=null)&&!N){return o.call(P,Math.max(P.length-O,0))}else{return P[P.length-1]}};M.rest=M.tail=M.drop=function(P,O,N){return o.call(P,(O==null)||N?1:O)};M.compact=function(N){return M.filter(N,M.identity)};var x=function(O,P,N){I(O,function(Q){if(M.isArray(Q)){P?H.apply(N,Q):x(Q,P,N)}else{N.push(Q)}});return N};M.flatten=function(O,N){return x(O,N,[])};M.without=function(N){return M.difference(N,o.call(arguments,1))};M.uniq=M.unique=function(T,S,R,Q){if(M.isFunction(S)){Q=R;R=S;S=false}var O=R?M.map(T,R,Q):T;var P=[];var N=[];I(O,function(V,U){if(S?(!U||N[N.length-1]!==V):!M.contains(N,V)){N.push(V);P.push(T[U])}});return P};M.union=function(){return M.uniq(y.apply(C,arguments))};M.intersection=function(O){var N=o.call(arguments,1);return M.filter(M.uniq(O),function(P){return M.every(N,function(Q){return M.indexOf(Q,P)>=0})})};M.difference=function(O){var N=y.apply(C,o.call(arguments,1));return M.filter(O,function(P){return !M.contains(N,P)})};M.zip=function(){var N=o.call(arguments);var Q=M.max(M.pluck(N,"length"));var P=new Array(Q);for(var O=0;O<Q;O++){P[O]=M.pluck(N,""+O)}return P};M.object=function(R,P){if(R==null){return{}}var N={};for(var Q=0,O=R.length;Q<O;Q++){if(P){N[R[Q]]=P[Q]}else{N[R[Q][0]]=R[Q][1]}}return N};M.indexOf=function(R,P,Q){if(R==null){return -1}var O=0,N=R.length;if(Q){if(typeof Q=="number"){O=(Q<0?Math.max(0,N+Q):Q)}else{O=M.sortedIndex(R,P);return R[O]===P?O:-1}}if(n&&R.indexOf===n){return R.indexOf(P,Q)}for(;O<N;O++){if(R[O]===P){return O}}return -1};M.lastIndexOf=function(R,P,Q){if(R==null){return -1}var N=Q!=null;if(l&&R.lastIndexOf===l){return N?R.lastIndexOf(P,Q):R.lastIndexOf(P)}var O=(N?Q:R.length);while(O--){if(R[O]===P){return O}}return -1};M.range=function(S,Q,R){if(arguments.length<=1){Q=S||0;S=0}R=arguments[2]||1;var O=Math.max(Math.ceil((Q-S)/R),0);var N=0;var P=new Array(O);while(N<O){P[N++]=S;S+=R}return P};var G=function(){};M.bind=function(Q,O){var N,P;if(Q.bind===F&&F){return F.apply(Q,o.call(arguments,1))}if(!M.isFunction(Q)){throw new TypeError}N=o.call(arguments,2);return P=function(){if(!(this instanceof P)){return Q.apply(O,N.concat(o.call(arguments)))}G.prototype=Q.prototype;var S=new G;G.prototype=null;var R=Q.apply(S,N.concat(o.call(arguments)));if(Object(R)===R){return R}return S}};M.bindAll=function(O){var N=o.call(arguments,1);if(N.length==0){N=M.functions(O)}I(N,function(P){O[P]=M.bind(O[P],O)});return O};M.memoize=function(P,O){var N={};O||(O=M.identity);return function(){var Q=O.apply(this,arguments);return M.has(N,Q)?N[Q]:(N[Q]=P.apply(this,arguments))}};M.delay=function(O,P){var N=o.call(arguments,2);return setTimeout(function(){return O.apply(null,N)},P)};M.defer=function(N){return M.delay.apply(M,[N,1].concat(o.call(arguments,1)))};M.throttle=function(S,U){var Q,P,T,N;var R=0;var O=function(){R=new Date;T=null;N=S.apply(Q,P)};return function(){var V=new Date;var W=U-(V-R);Q=this;P=arguments;if(W<=0){clearTimeout(T);T=null;R=V;N=S.apply(Q,P)}else{if(!T){T=setTimeout(O,W)}}return N}};M.debounce=function(P,R,O){var Q,N;return function(){var V=this,U=arguments;var T=function(){Q=null;if(!O){N=P.apply(V,U)}};var S=O&&!Q;clearTimeout(Q);Q=setTimeout(T,R);if(S){N=P.apply(V,U)}return N}};M.once=function(P){var N=false,O;return function(){if(N){return O}N=true;O=P.apply(this,arguments);P=null;return O}};M.wrap=function(N,O){return function(){var P=[N];H.apply(P,arguments);return O.apply(this,P)}};M.compose=function(){var N=arguments;return function(){var O=arguments;for(var P=N.length-1;P>=0;P--){O=[N[P].apply(this,O)]}return O[0]}};M.after=function(O,N){if(O<=0){return N()}return function(){if(--O<1){return N.apply(this,arguments)}}};M.keys=e||function(P){if(P!==Object(P)){throw new TypeError("Invalid object")}var O=[];for(var N in P){if(M.has(P,N)){O[O.length]=N}}return O};M.values=function(P){var N=[];for(var O in P){if(M.has(P,O)){N.push(P[O])}}return N};M.pairs=function(P){var O=[];for(var N in P){if(M.has(P,N)){O.push([N,P[N]])}}return O};M.invert=function(P){var N={};for(var O in P){if(M.has(P,O)){N[P[O]]=O}}return N};M.functions=M.methods=function(P){var O=[];for(var N in P){if(M.isFunction(P[N])){O.push(N)}}return O.sort()};M.extend=function(N){I(o.call(arguments,1),function(O){if(O){for(var P in O){N[P]=O[P]}}});return N};M.pick=function(O){var P={};var N=y.apply(C,o.call(arguments,1));I(N,function(Q){if(Q in O){P[Q]=O[Q]}});return P};M.omit=function(P){var Q={};var O=y.apply(C,o.call(arguments,1));for(var N in P){if(!M.contains(O,N)){Q[N]=P[N]}}return Q};M.defaults=function(N){I(o.call(arguments,1),function(O){if(O){for(var P in O){if(N[P]==null){N[P]=O[P]}}}});return N};M.clone=function(N){if(!M.isObject(N)){return N}return M.isArray(N)?N.slice():M.extend({},N)};M.tap=function(O,N){N(O);return O};var J=function(U,T,O,P){if(U===T){return U!==0||1/U==1/T}if(U==null||T==null){return U===T}if(U instanceof M){U=U._wrapped}if(T instanceof M){T=T._wrapped}var R=d.call(U);if(R!=d.call(T)){return false}switch(R){case"[object String]":return U==String(T);case"[object Number]":return U!=+U?T!=+T:(U==0?1/U==1/T:U==+T);case"[object Date]":case"[object Boolean]":return +U==+T;case"[object RegExp]":return U.source==T.source&&U.global==T.global&&U.multiline==T.multiline&&U.ignoreCase==T.ignoreCase}if(typeof U!="object"||typeof T!="object"){return false}var N=O.length;while(N--){if(O[N]==U){return P[N]==T}}O.push(U);P.push(T);var W=0,X=true;if(R=="[object Array]"){W=U.length;X=W==T.length;if(X){while(W--){if(!(X=J(U[W],T[W],O,P))){break}}}}else{var S=U.constructor,Q=T.constructor;if(S!==Q&&!(M.isFunction(S)&&(S instanceof S)&&M.isFunction(Q)&&(Q instanceof Q))){return false}for(var V in U){if(M.has(U,V)){W++;if(!(X=M.has(T,V)&&J(U[V],T[V],O,P))){break}}}if(X){for(V in T){if(M.has(T,V)&&!(W--)){break}}X=!W}}O.pop();P.pop();return X};M.isEqual=function(O,N){return J(O,N,[],[])};M.isEmpty=function(O){if(O==null){return true}if(M.isArray(O)||M.isString(O)){return O.length===0}for(var N in O){if(M.has(O,N)){return false}}return true};M.isElement=function(N){return !!(N&&N.nodeType===1)};M.isArray=u||function(N){return d.call(N)=="[object Array]"};M.isObject=function(N){return N===Object(N)};I(["Arguments","Function","String","Number","Date","RegExp"],function(N){M["is"+N]=function(O){return d.call(O)=="[object "+N+"]"}});if(!M.isArguments(arguments)){M.isArguments=function(N){return !!(N&&M.has(N,"callee"))}}if(typeof(/./)!=="function"){M.isFunction=function(N){return typeof N==="function"}}M.isFinite=function(N){return isFinite(N)&&!isNaN(parseFloat(N))};M.isNaN=function(N){return M.isNumber(N)&&N!=+N};M.isBoolean=function(N){return N===true||N===false||d.call(N)=="[object Boolean]"};M.isNull=function(N){return N===null};M.isUndefined=function(N){return N===void 0};M.has=function(O,N){return j.call(O,N)};M.noConflict=function(){w._=k;return this};M.identity=function(N){return N};M.times=function(R,Q,P){var N=Array(R);for(var O=0;O<R;O++){N[O]=Q.call(P,O)}return N};M.random=function(O,N){if(N==null){N=O;O=0}return O+(0|Math.random()*(N-O+1))};var m={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};m.unescape=M.invert(m.escape);var K={escape:new RegExp("["+M.keys(m.escape).join("")+"]","g"),unescape:new RegExp("("+M.keys(m.unescape).join("|")+")","g")};M.each(["escape","unescape"],function(N){M[N]=function(O){if(O==null){return""}return(""+O).replace(K[N],function(P){return m[N][P]})}});M.result=function(N,P){if(N==null){return null}var O=N[P];return M.isFunction(O)?O.call(N):O};M.mixin=function(N){I(M.functions(N),function(O){var P=M[O]=N[O];M.prototype[O]=function(){var Q=[this._wrapped];H.apply(Q,arguments);return s.call(this,P.apply(M,Q))}})};var z=0;M.uniqueId=function(N){var O=""+ ++z;return N?N+O:O};M.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var v=/(.)^/;var h={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var i=/\\|'|\r|\n|\t|\u2028|\u2029/g;M.template=function(V,Q,P){P=M.defaults({},P,M.templateSettings);var R=new RegExp([(P.escape||v).source,(P.interpolate||v).source,(P.evaluate||v).source].join("|")+"|$","g");var S=0;var N="__p+='";V.replace(R,function(X,Y,W,aa,Z){N+=V.slice(S,Z).replace(i,function(ab){return"\\"+h[ab]});if(Y){N+="'+\n((__t=("+Y+"))==null?'':_.escape(__t))+\n'"}if(W){N+="'+\n((__t=("+W+"))==null?'':__t)+\n'"}if(aa){N+="';\n"+aa+"\n__p+='"}S=Z+X.length;return X});N+="';\n";if(!P.variable){N="with(obj||{}){\n"+N+"}\n"}N="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+N+"return __p;\n";try{var O=new Function(P.variable||"obj","_",N)}catch(T){T.source=N;throw T}if(Q){return O(Q,M)}var U=function(W){return O.call(this,W,M)};U.source="function("+(P.variable||"obj")+"){\n"+N+"}";return U};M.chain=function(N){return M(N).chain()};var s=function(N){return this._chain?M(N).chain():N};M.mixin(M);I(["pop","push","reverse","shift","sort","splice","unshift"],function(N){var O=C[N];M.prototype[N]=function(){var P=this._wrapped;O.apply(P,arguments);if((N=="shift"||N=="splice")&&P.length===0){delete P[0]}return s.call(this,P)}});I(["concat","join","slice"],function(N){var O=C[N];M.prototype[N]=function(){return s.call(this,O.apply(this._wrapped,arguments))}});M.extend(M.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);var omitUndefined=function(a){return _.omit(a,"undefined")};if(!Array.prototype.filter){Array.prototype.filter=function(b){if(this==null){throw new TypeError()}var f=Object(this);var a=f.length>>>0;if(typeof b!="function"){throw new TypeError()}var e=[];var d=arguments[1];for(var c=0;c<a;c++){if(c in f){var g=f[c];if(b.call(d,g,c,f)){e.push(g)}}}return e}}if(!Array.prototype.map){Array.prototype.map=function(i,h){var b,a,c;if(this==null){throw new TypeError(" this is null or not defined")}var e=Object(this);var f=e.length>>>0;if(typeof i!=="function"){throw new TypeError(i+" is not a function")}if(h){b=h}a=new Array(f);c=0;while(c<f){var d,g;if(c in e){d=e[c];g=i.call(b,d,c,e);a[c]=g}c++}return a}}var Award=function(b,a,c){this.audience=b;this.engagementType=a;this.metrics=c;this.init()};Award.prototype={engagementTypeNounsList:{viewed:"views",discussed:"discussion",saved:"saves",cited:"citation",recommended:"recommendation"},init:function(){this.engagementTypeNoun=this.engagementTypeNounsList[this.engagementType];this.topMetric=this.getTopMetric(this.metrics);this.isHighly=this.isHighly(this.metrics);this.displayAudience=this.audience.replace("public","the public")},isHighly:function(a){return _.some(a,function(b){if(typeof b.percentiles==="undefined"){return false}else{if(b.percentiles.CI95_lower>=75&&b.actualCount>=b.minForAward){return true}else{return false}}})},getTopMetric:function(a){var b=_.max(a,function(d){return d.actualCount}).actualCount;var c=_.max(a,function(d){var e=(d.actualCount/b-0.0001);if(typeof d.percentiles=="undefined"){return e}else{return d.percentiles.CI95_lower+e}});return c}};function Item(itemData,itemView,$){this.makeAwardsList=function(metrics){var awards=[];var audiencesObj=omitUndefined(_.groupBy(metrics,"audience"));_.each(audiencesObj,function(audienceMetrics,audienceName){var engagementTypesObj=omitUndefined(_.groupBy(audienceMetrics,"engagementType"));_.each(engagementTypesObj,function(engagementType,engagementTypeName){awards.push(new Award(audienceName,engagementTypeName,engagementType))})});if(awards.length){awards.big=["here is an item"];awards.any=["here is an item"]}return awards};this.init=function(itemData,itemView){var metricInfoKeys=["name","audience","engagementType","display","minForAward"];var metricInfo=_.object(_.map([["citeulike:bookmarks","scholars","saved","badge",3],["delicious:bookmarks","public","saved","badge",3],["dryad:most_downloaded_file"],["dryad:package_views","scholars","viewed","badge",3],["dryad:total_downloads","scholars","viewed","badge",3],["figshare:views","scholars","viewed","badge",3],["figshare:downloads","scholars","viewed","badge",3],["figshare:shares","scholars","discussed","badge",3],["facebook:shares","public","discussed","badge",3],["facebook:comments","public","discussed","badge",3],["facebook:likes","public","discussed","badge",3],["facebook:clicks","public","discussed","badge",3],["github:forks","public","cited","badge",3],["github:stars","public","saved","badge",3],["github:watchers","public","saved","badge",3],["mendeley:career_stage"],["mendeley:country"],["mendeley:discipline"],["mendeley:student_readers"],["mendeley:developing_countries"],["mendeley:groups"],["mendeley:readers","scholars","saved","badge",3],["pmc:pdf_downloads"],["pmc:abstract_views"],["pmc:fulltext_views"],["pmc:unique_ip_views"],["pmc:figure_views"],["pmc:suppdata_views"],["plosalm:crossref"],["plosalm:html_views","public","viewed","badge",3],["plosalm:pdf_views","scholars","viewed","badge",3],["plosalm:pmc_abstract"],["plosalm:pmc_figure"],["plosalm:pmc_full-text"],["plosalm:pmc_pdf"],["plosalm:pmc_supp-data"],["plosalm:pmc_unique-ip"],["plosalm:pubmed_central"],["plosalm:scopus"],["plossearch:mentions","scholars","cited","badge",3],["pubmed:f1000","scholars","recommended","badge",1],["pubmed:pmc_citations","scholars","cited",0,0],["pubmed:pmc_citations_editorials","scholars","recommended",0,0],["pubmed:pmc_citations_reviews","scholars","cited",0,0],["scienceseeker:blog_posts","scholars","discussed","badge",0],["scopus:citations","scholars","cited","badge",3],["researchblogging:blogs","scholars","discussed",0,0],["slideshare:comments","public","discussed","badge",3],["slideshare:downloads","public","viewed","badge",3],["slideshare:favorites","public","recommended","badge",3],["slideshare:views","public","viewed","badge",3],["topsy:influential_tweets","public","discussed","zoom",0],["topsy:tweets","public","discussed","badge",3],["wikipedia:mentions","public","cited","badge",1]],function(metric){return[metric[0],_.object(metricInfoKeys,metric)]}));this.metricInfo=metricInfo;this.itemView=itemView;if(itemData.hasOwnProperty("_id")){this.dict=this.processDict(itemData)}else{this.dict=false;this.itemId=itemData}};this.developing_countries="Afghanistan|Albania|Algeria|Angola|Antigua and Barbuda|Argentina|Armenia|Azerbaijan|Bahamas|Bahrain|Bangladesh|Barbados|Belarus|Belize|Benin|Bhutan|Bolivia|Bosnia and Herzegovina|Botswana|Brazil|Brunei|Bulgaria|Burkina Faso|Burma|Burundi|Cambodia|Cameroon|Cape Verde|Central African Republic|Chad|Chile|China|Colombia|Comoros|Cuba|Democratic Republic of the Congo|Republic of the Congo|Costa Rica|C\u00F4te d Ivoire|Croatia|Djibouti|Dominica|Dominican Republic|Ecuador|Egypt|El Salvador|Equatorial Guinea|Eritrea|Ethiopia|Fiji|Gabon|The Gambia|Georgia|Ghana|Grenada|Guatemala|Guinea|Guinea-Bissau|Guyana|Haiti|Honduras|Hungary|India|Indonesia|Iran|Iraq|Jamaica|Jordan|Kazakhstan|Kenya|Kiribati|Kuwait|Kyrgyzstan|Laos|Latvia|Lebanon|Lesotho|Liberia|Libya|Lithuania|Macedonia|Madagascar|Malawi|Malaysia|Maldives|Mali|Marshall Islands|Mauritania|Mauritius|Mexico|Federated States of Micronesia|Moldova|Mongolia|Montenegro|Morocco|Mozambique|Namibia|Nauru|Nepal|Nicaragua|Niger|Nigeria|North Korea|Oman|Pakistan|Palau|Panama|Papua New Guinea|Paraguay|Peru|Philippines|Poland|Qatar|Romania|Russia|Rwanda|Saint Kitts and Nevis|Saint Lucia|Saint Vincent and the Grenadines|Samoa|S\u00E3o Tom\u00E9 and Pr\u00EDncipe|Saudi Arabia|Senegal|Serbia|Seychelles|Sierra Leone|Solomon Islands|Somalia|South Africa|South Sudan|Sri Lanka|Sudan|Suriname|Swaziland|Syria|Tajikistan|Tanzania|Thailand|Timor-Leste|Togo|Tonga|Trinidad and Tobago|Tunisia|Turkey|Turkmenistan|Tuvalu|Uganda|Ukraine|United Arab Emirates|Uruguay|Uzbekistan|Vanuatu|Venezuela|Vietnam|Yemen|Zambia|Zimbabwe";this.render=function(){return this.itemView.render(this.dict)};this.addMetricsInfoDataToMetrics=function(metrics){var metricInfo=this.metricInfo;_.map(metrics,function(metric,metricName){_.extend(metric,metricInfo[metricName])});return metrics};this.get_mendeley_percent=function(metricDict,key_substring){if(metricDict==undefined){return 0}var re=new RegExp(key_substring,"i");mendeleyRelevantKeys=metricDict.values.raw.filter(function(x){return x.name.match(re)});if(typeof mendeleyRelevantKeys[0]=="undefined"){return(0)}mendeleyPercentages=mendeleyRelevantKeys.map(function(x){return x.value});if(typeof mendeleyPercentages[0]=="undefined"){return(0)}sum=eval(mendeleyPercentages.join("+"));return(sum)};this.mendeley_reader_subset_count=function(metricsDict,subset_type){if(typeof metricsDict["mendeley:readers"]=="undefined"){return(0)}if(subset_type=="student"){percent=this.get_mendeley_percent(metricsDict["mendeley:career_stage"],"student")}if(subset_type=="developing_countries"){percent=this.get_mendeley_percent(metricsDict["mendeley:country"],this.developing_countries)}total_mendeley_readers=metricsDict["mendeley:readers"].values.raw;total=Math.round(total_mendeley_readers*percent/100);return(total)};this.update_metric=function(metric,display_name,value){metric.static_meta["display_name"]=display_name;metric.values={};metric.values["raw"]=value;return(metric)};this.add_derived_metrics=function(metricsDict){var total=this.mendeley_reader_subset_count(metricsDict,"student");if(total>0){var templateMetric=$.extend(true,{},metricsDict["mendeley:readers"]);var newMetric=this.update_metric(templateMetric,"readers: students",total);metricsDict["mendeley:student_readers"]=newMetric}var total=this.mendeley_reader_subset_count(metricsDict,"developing_countries");if(total>0){var templateMetric=$.extend(true,[],metricsDict["mendeley:readers"]);var newMetric=this.update_metric(templateMetric,"readers: developing countries",total);metricsDict["mendeley:developing_countries"]=newMetric}return(metricsDict)};this.getMetricPercentiles=function(metricsDict){for(var metricName in metricsDict){for(var normRefSetName in metricsDict[metricName].values){if(normRefSetName.indexOf("raw")==-1){metricsDict[metricName].percentiles=metricsDict[metricName].values[normRefSetName];metricsDict[metricName].topPercent=100-metricsDict[metricName].percentiles.CI95_lower}}}return metricsDict};this.expandMetricMetadta=function(metrics,year){var interactionDisplayNames={f1000:"recommendations",pmc_citations:"citations",html_views:"html views",pdf_views:"pdf views"};_.map(metrics,function(metric){metric.displayCount=metric.values.raw;metric.actualCount=(metric.values.raw=="Yes")?1:metric.values.raw;var plural=metric.actualCount>1;metric.environment=metric.static_meta.provider;var interaction=metric.name.split(":")[1];if(interactionDisplayNames[interaction]){interaction=interactionDisplayNames[interaction]}metric.displayInteraction=(plural)?interaction:interaction.slice(0,-1);metric.referenceSetYear=year});return metrics};this.processDict=function(dict){dict.metrics=this.addMetricsInfoDataToMetrics(dict.metrics);dict.metrics=this.expandMetricMetadta(dict.metrics,dict.biblio.year);dict.metrics=this.getMetricPercentiles(dict.metrics);dict.awards=new this.makeAwardsList(dict.metrics);return dict};this.get=function(apiRoot,apiKey,successCallback,updatingCallback,noItemCallback){var thisThing=this;var id=this.itemId;var registerParam=(noItemCallback)?"":"&register=true";var url="http://"+apiRoot+"/v1/item/"+id[0]+"/"+id[1]+"?key="+apiKey+registerParam;var logIfFailedRegistration=function(data){if(registerParam){if(data.is_registered==false){console.log("Automatic registration failed for "+id[0]+":"+id[1]+": quota reached for api key '"+apiKey+"'. Contact team@impactstory.org to remedy.")}}};$.ajax({url:url,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",statusCode:{200:function(data){dict=thisThing.processDict(data);thisThing.dict=dict;successCallback(dict,id);logIfFailedRegistration(data)},210:function(data){updatingCallback(data);logIfFailedRegistration(data)},403:function(data){console.log("Invalid api key '"+apiKey+"'. Contact team@impactstory.org to remedy.");if(noItemCallback){noItemCallback(data)}},404:function(data){if(noItemCallback){noItemCallback(data)}}}})};this.create=function(apiRoot,successCallback,errorCallback){var apiKey="embed";var thisThing=this;var id=this.itemId};this.init(itemData,itemView);return true}function ItemView(a){this.sortByMetricValueDesc=function(c,b){if(typeof c.value!="number"){return 1}if(typeof b.value!="number"){return -1}if(c.value<b.value){return 1}if(c.value>b.value){return -1}return 0};this.renderBiblio=function(f,d){var e="";f.url=d;f.title=f.title||"no title";if(f.create_date){f.year=f.create_date.slice(0,4)}if(f.authors){var c=f.authors.split(",",3).join(",");if(c.length<f.authors.length){c+=" et al."}f.authors=c}var b="biblio_"+f.genre;return a(ich[b](f,true))};this.findBarLabelOffsets=function(g,b){var e=27;if(b==100){e=32}var d=b-g;if(d<e){var c=d-e;var f=c/2}else{var f=0}return f};this.findBarMargins=function(f,g){var d=7;var c=f;var e=100-g;var b=d-(g-f);if(b>0){c-=b/2;e-=b/2}return[c,e]};this.renderZoom=function(c){var b={};b.audiences=_.chain(c).groupBy("audience").map(function(f,g){return{audience:g,cells:f}}).sortBy(function(f){return f.audience}).reverse().value();var d=a(ich.zoomTable(b,true));var e=this;d.find("div.metric-perc-range.ci").each(function(){var g=a(this).find("span.endpoint.start span.value").text();var f=a(this).find("span.endpoint.end span.value").text();var i=e.findBarLabelOffsets(g,f);var h=e.findBarMargins(g,f);a(this).css({"margin-left":h[0]+"%","margin-right":h[1]+"%"}).find("span.endpoint.start").css("left",i+"px").end().find("span.endpoint.end").css("right",i+"px")});d.find("ul.metrics div.meta img").tooltip();d.find("ul.metrics div.metric-perc-range").tooltip();return d};this.renderBadges=function(b){var d=_(b).groupBy("isHighly");var c=a(ich.badges({big:d["true"],any:d["false"]}),true);c.find(".ti-badge").popover({trigger:"hover",placement:"top"});return c};this.render=function(f){var e=ich.displayItem(f);var b=(f.aliases.url)?f.aliases.url[0]:false;var d=this.renderBiblio(f.biblio,b);e.find("div.biblio").append(d);var c=this.renderZoom(f.awards,true);e.find("div.zoom").append(c);var g=this.renderBadges(f.awards);e.find("div.badges").append(g);return e}}function ItemController(b){this.itemReportPageInit=function(){b("#update-report-button").remove();b("#csv-report-button").remove();b("#num-items").remove();var c=new ItemView(b);var d=new Item([reportIdNamespace,reportId],c,b);d.get(api_root,"item-report-page",this.insertRenderedItemIntoPage,function(e){console.log("still updating item report page")},function(e){alert("Sorry, this item isn't in our database yet.")})};this.insertRenderedItemIntoPage=function(d){var c=new ItemView(b);var e=c.render(d);e.find("div.zoom").show();b("<div class='genre'></div>").append(e).appendTo("#metrics div.wrapper")};var a=b("body");a.on("click","div.item-header.zoomable",function(c){if(b(c.target).hasClass("help-text")){console.log("help-text");return true}b(this).parents("li.item").find("div.zoom").slideToggle(500,function(){b(this).parents("li.item").toggleClass("zoomed")});return false});a.on("click","a.item-help",function(){b("#context").modal("show");return false})};