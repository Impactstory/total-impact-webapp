(function(){function i(){n=window.jQuery.noConflict(!0);s()}function s(){function e(e){var t="1999-01-01T00:00:00.000000";for(ts in e)ts>t&&(t=ts);return t}function r(e,t){return typeof e.value!="number"?1:typeof t.value!="number"?-1:e.value<t.value?1:e.value>t.value?-1:0}function i(t){t.metricsArr=[];for(metricName in t.metrics){thisMetric=t.metrics[metricName];thisMetric.name=metricName;var n=e(t.metrics[metricName].values);if(n){var i=t.metrics[metricName].values[n];thisMetric.ts=n;thisMetric.value=i}thisMetric.value&&t.metricsArr.push(thisMetric)}t.metricsArr=t.metricsArr.filter(function(e){good_to_print=typeof e["value"]=="number";typeof e["value"]=="string"&&(good_to_print=!0);return good_to_print});t.metricsArr.sort(r);typeof ich.itemtemplate=="undefined"&&ich.addTemplate("itemtemplate",'<div class="item" id="{{ id }}">\r\n  <div class="biblio"></div>\r\n  <ul class="metrics">{{#metricsArr}}\r\n    <li>\r\n      <a href="{{provenance_url}}">\r\n        <span class="last-update">{{ ts }}</span>\r\n        <span class="metric-value">{{ value }}</span>\r\n        <span class="metric-name-img">\r\n          <img src="{{ static_meta.icon }}" width="16" height="16" border="0">\r\n          <span class="metric-name">{{ static_meta.provider }} {{ static_meta.display_name }}</span>\r\n        </span>\r\n      </a>\r\n    </li>\r\n    {{/metricsArr}}\r\n  </ul>\r\n</div>');return ich.itemtemplate(t)}function s(e){n("div#ti-data").empty().append(i(e))}function o(e,r,i){n.ajax({url:t+"/v1/item/"+e+"/"+r+"?key=EXAMPLE",type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",statusCode:{210:function(t){console.log("still updating");s(t);setTimeout(function(){o(e,r,i)},i)},200:function(e){console.log("done with updating");s(e);return!1}}})}function u(e){var t=[];if(e.indexOf(":")>0){t[0]=e.split(":")[0];t[1]=e.substr(t[0].length+1);if(t[0]=="http"){t[0]="url";t[1]=e}}return t}function a(e){var t=document.createElement("link");t.rel="stylesheet";t.type="text/css";t.href=e;t.media="all";document.lastChild.firstChild.appendChild(t)}function f(e){var t=document.createElement("script");t.src=e;document.getElementsByTagName("head")[0].appendChild(t)}window.console||(console={log:function(){}});n.ajaxSetup({cache:!1});var l='<img id="ti-loading" src="http://impactstory.org/static/img/ajax-loader.gif" alt="loading..." />';a("http://total-impact.org/static/css/embed.css");f("http://total-impact.org/static/js/icanhaz.min.js");n(document).ready(function(e){e("span#ti-id").hide();e("div#ti-data").html(l+" Loading...");var n=u(e("span#ti-id").html()),r=n[0],i=n[1];e.ajax({url:t+"/v1/item/"+r+"/"+i+"?key=EXAMPLE",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),success:function(e){console.log("item created. ");o(r,i,1e3)}})})}var e="http://impactstory.org",t="http://api.impactstory.org",n;if(window.jQuery===undefined||window.jQuery.fn.jquery!=="1.4.2"){var r=document.createElement("script");r.setAttribute("type","text/javascript");r.setAttribute("src","https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js");r.readyState?r.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&i()}:r.onload=i;(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(r)}else{n=window.jQuery;s()}})();