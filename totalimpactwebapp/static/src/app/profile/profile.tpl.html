<div class="profile-header" ng-show="userExists">
   <div class="wrapper">
      <div class="loading" ng-show="!user.about.id">
         <div class="working"><i class="icon-refresh icon-spin"></i><span class="text">Loading profile info...</span></div>
      </div>
      <div class="my-picture" ng-show="user.about.id">
         <a href="http://www.gravatar.com" >
            <img class="gravatar" ng-src="http://www.gravatar.com/avatar/{{ user.about.email_hash }}?s=110&d=mm" data-toggle="tooltip" class="gravatar" rel="tooltip" title="Modify your icon at Gravatar.com" />
         </a>
      </div>
      <div class="my-vitals">
         <h2 class='page-title editable-name' id="profile-owner-name">
            <span class="given-name editable" data-name="given_name">{{ user.about.given_name }}</span>
            <span class="surname editable" data-name="surname">{{ user.about.surname }}</span>
         </h2>
         <div class="external-usernames">
            <ul>
               <li ng-show="user.about.academia_edu_id" style="display: none;">
                  <a href="https://academia.edu/">
                     <img src="http://www.academia.edu/favicon.ico">
                     <span class="service">Academia.edu</span>
                  </a>
               </li>        
               <li ng-show="user.about.figshare_id" style="display: none;">
                  <a href="http://figshare.com">
                     <img src="http://figshare.com/static/img/favicon.png">
                     <span class="service">figshare</span>
                  </a>
               </li>           
               <li ng-show="user.about.github_id" style="display: none;">
                  <a href="https://github.com/">
                     <img src="https://github.com/fluidicon.png">
                     <span class="service">GitHub</span>
                  </a>
               </li>
               <li ng-show="user.about.google_scholar_id" style="display: none;">
                  <a href="https://github.com/">
                     <img src="http://scholar.google.com/favicon.ico">
                     <span class="service">Google Scholar</span>
                  </a>
               </li>     
               <li ng-show="user.about.linkedin_id" style="display: none;">
                  <a href="https://linkedin.com/">
                     <img src="http://s.c.lnkd.licdn.com/scds/common/u/images/logos/favicons/v1/16x16/favicon.ico">
                     <span class="service">LinkedIn</span>
                  </a>
               </li>
               <li ng-show="user.about.mendeley_id" style="display: none;">
                  <a href="https://mendeley.com/">
                     <img src="http://www.mendeley.com/graphics/favicon.ico">
                     <span class="service">Mendeley</span>
                  </a>
               </li>                                                   
               <li ng-show="user.about.orcid_id" style="display: none;">
                  <a href="https://orcid.org/">
                     <img src="http://orcid.org/sites/about.orcid.org/files/orcid_16x16.ico">
                     <span class="service">ORCID</span>
                  </a>
               </li>
               <li ng-show="user.about.researchgate_id" style="display: none;">
                  <a href="https://researchgate.net/">
                     <img src="http://researchgate.net/favicon.ico">
                     <span class="service">ResearchGate</span>
                  </a>
               </li>
               <li ng-show="user.about.slideshare_id" style="display: none;">
                  <a href="https://www.slideshare.net/">
                     <img src="http://www.slideshare.net/favicon.ico">
                     <span class="service">Slideshare</span>
                  </a>
               </li>
               <li ng-show="user.about.twitter_id" style="display: none;">
                  <a href="https://twitter.com/">
                     <img src="https://twitter.com/favicon.ico">
                     <span class="service">Twitter</span>
                  </a>
               </li>
            </ul>

            <div class="add-linked-account" ng-show="currentUserIsProfileOwner()">
               <a href="/{{ user.about.url_slug }}/accounts">
                  <i class="icon-edit left"></i>
                  Add or edit accounts
               </a>
            </div>
         </div>
      </div>
      <div class="my-metrics">
         <ul class="profile-award-list">
            <li class="profile-award-container level-{{ profileAward.level }}"
                ng-include="'profile-award/profile-award.tpl.html'"
                ng-repeat="profileAward in profileAwards">
            </li>
         </ul>


      </div>
   </div>
</div>

<div class="product-controls" ng-show="userExists">
   <div class="wrapper">
      <div class="edit-controls btn-group">
         <div class="num-items">
            <span ng-hide="loadingProducts()" class="val-plus-text">
               <span class="value" id="number-products">{{ productsCount }}</span> research products
            </span>
            <a ng-click="showProductsWithoutMetrics = !showProductsWithoutMetrics" ng-show="showProductsWithoutMetrics">
               (hide <span class="value">{{ filterProducts(products, "withoutMetrics").length }}</span> without metrics)
            </a>
         </div>
      </div>
      <div class="view-controls">
         <!--<a><i class="icon-refresh"></i>Refresh metrics</a>-->
         <div class="admin-controls" ng-show="currentUserIsProfileOwner() && !page.isEmbedded()">
            <a href="/{{ user.about.url_slug }}/products/add">
               <i class="icon-upload"></i>Import
            </a>
            <a ng-click="dedup()"
               ng-class="{working: loading.is('dedup')}"
               class="dedup-button">
               <span class="content ready" ng-show="!loading.is('dedup')">
                  <i class="icon-copy"></i>
                  <span class="text">Merge duplicates</span>
               </span>
               <span class="content working" ng-show="loading.is('dedup')">
                  <i class="icon-refresh icon-spin" ng-show="loading.is('dedup')"></i>
                  <span class="text">Merging duplicates</span>
               </span>
            </a>
         </div>
         <div class="everyone-controls">
            <a ng-click="openProfileEmbedModal()" ng-show="!page.isEmbedded()">
               <i class="icon-suitcase"></i>
               Embed
            </a>
            <span class="dropdown download">
               <a id="adminmenu" role="button" class="dropdown-toggle"><i class="icon-download"></i>Download</a>
               <ul class="dropdown-menu" role="menu" aria-labelledby="adminmenu">
                  <li><a tabindex="-1" href="{{ page.getBaseUrl }}/user/{{ user.about.url_slug }}/products.csv" target="_self"><i class="icon-table"></i>csv</a></li>
                  <li><a tabindex="-1" href="{{ page.getBaseUrl }}/user/{{ user.about.url_slug }}/products" target="_blank"><i class="json">{&hellip;}</i>json</a></li>
               </ul>
            </span>
         </div>
      </div>
   </div>
</div>

<div class="products" ng-show="userExists">
   <div class="wrapper">
      <div class="loading" ng-show="loadingProducts()">
         <div class="working products-loading"><i class="icon-refresh icon-spin"></i><span class="text">Loading products...</span></div>
      </div>

      <ul class="products-list">
         <li class="product {{ product.genre }}"
             ng-class="{'heading': product.is_heading, 'real-product': !product.is_heading, first: $first}"
             ng-repeat="product in products | orderBy:['genre', 'account', 'is_heading', '-awardedness_score', '-metric_raw_sum']"
             ng-controller="productCtrl"
             ng-show="product.has_metrics || showProductsWithoutMetrics || product.is_heading"
             id="{{ product._id }}"
             on-repeat-finished>

            <div class="biblio-container" ng-bind-html-unsafe="product.markup.biblio"></div>
            <div class="metrics-container" ng-bind-html-unsafe="product.markup.metrics"></div>

         </li>
      </ul>
   </div>

   <div class="products-without-metrics wrapper"
        ng-show="!loadingProducts() && !showProductsWithoutMetrics && filterProducts(products, 'withoutMetrics').length">
      <div class="well">
         Another <span class="value">{{ filterProducts(products, "withoutMetrics").length }}</span> products aren't shown, because we couldn't find any impact data for them.
         <a ng-click="showProductsWithoutMetrics = !showProductsWithoutMetrics">Show these, too.</a>
      </div>
   </div>


</div>

<div class="user-does-not-exist no-page" ng-show="!userExists">
   <h2>Whoops!</h2>
   <p>We don't have a user account for <span class="slug">'{{ slug }}.'</span><br> Would you like to <a href="/signup">make one?</a></p>

</div>

<div class="signup-banner"
     ng-show="userExists && !isAuthenticated()"
     ng-if="!hideSignupBanner"
     ng-animate="{leave: 'animated fadeOutDown'}">

   <span class="msg">Join {{ user.about.given_name }} and thousands of other scientists on Impactstory!</span>
   <a class="signup-button btn btn-primary btn-sm" href="/signup">Make your free profile</a>
   <a class="close-link" ng-click="hideSignupBannerNow()">&times;</a>
</div>