<div class="genre-page">
   <div class="loading" ng-show="isRendering()">
      <div class="working"><i class="icon-refresh icon-spin"></i><span class="text">Loading profile info...</span></div>
   </div>
   <div class="wrapper" ng-show="!isRendering()">

      <div class="header">
         <h2>
            <span class="count">
               {{ profileService.productsByGenre(genre_name).length }}
            </span>
            <span class="text">
               {{ genre.plural_name }}
            </span>
         </h2>
         <div class="genre-summary">
            <div class="genre-summary-top">
               <ul class="genre-cards-best">
                  <li class="genre-card" ng-repeat="card in sliceSortedCards(genre.cards, 0, 3).slice().reverse()">

                     <span class="feature-controls">

                        <a ng-click="pinboardService.pin(['genre', genre.name, 'sum', card.provider, card.interaction])"
                           ng-if="!pinboardService.isPinned(['genre', genre.name, 'sum', card.provider, card.interaction])"
                           tooltip="Feature this metric on your profile front page"
                           tooltip-placement="bottom"
                           class="feature-this">
                           <i class="icon-star-empty"></i>
                        </a>

                        <a ng-click="pinboardService.unPin(['genre', genre.name, 'sum', card.provider, card.interaction])"
                           ng-if="pinboardService.isPinned(['genre', genre.name, 'sum', card.provider, card.interaction])"
                           tooltip="Feature this metric on your profile front page"
                           tooltip-placement="bottom"
                           class="unfeature-this">
                           <i class="icon-star"></i>
                        </a>

                     </span>

                     <span class="img-and-value">
                        <img ng-src='/static/img/favicons/{{ card.provider }}_{{ card.interaction }}.ico' class='icon' >
                        <span class="value">{{ nFormat(card.current_value) }}</span>
                     </span>

                     <span class="key">
                        <span class="interaction">{{ card.interaction }}</span>
                     </span>

                  </li>
               </ul>
               <div class="clearfix"></div>
            </div>
            <div class="genre-summary-more">

            </div>
         </div>
         <span class="more-button">
            <span class="more"><i class="icon-caret-down left"></i>more stats</span>
         </span>

      </div>
      <div class="products">
         <ul class="products-list">
            <li class="product genre-{{ product.genre }}"
                ng-class="{first: $first}"
                ng-repeat="product in profileService.productsByGenre(genre_name) | orderBy:['-awardedness_score', '-metric_raw_sum', 'biblio.title']"
                id="{{ product.tiid }}"
                on-repeat-finished>


               <!-- users must be logged in -->
               <div class="product-margin" ng-show="security.isLoggedIn(url_slug)">
                  <span class="delete-product-controls"> <!--needed to style tooltip -->
                     <a class="remove-product"
                        tooltip="Delete this product"
                        ng-click="profileService.removeProduct(product)">
                        <i class="icon-trash icon"></i>
                     </a>
                  </span>
                  <span class="feature-product-controls">
                     <a class="feature-product"
                        ng-click="pinboardService.pin(['product', product.tiid])"
                        ng-if="!pinboardService.isPinned(['product', product.tiid])"
                        tooltip="Feature this product on your profile front page">
                        <i class="icon-star-empty"></i>
                     </a>
                     <a class="unfeature-product"
                        ng-click="pinboardService.unPin(['product', product.tiid])"
                        ng-if="pinboardService.isPinned(['product', product.tiid])"
                        tooltip="This product is featured on your profile front page; click to unfeature.">
                        <i class="icon-star"></i>
                     </a>
                  </span>

               </div>
               <div class="product-container" ng-bind-html="trustHtml(product.markup)"></div>
            </li>
         </ul>
      </div>
   </div>
</div>