<div class="product">

   {% include 'biblio.html' %}

   <ul class="metric-details-list">
      {% for metric in product.metrics %}
{#         @todo "orderBy: ['-award.isHighly', '-award.audience']" #}
{#         @todo make popovers work via jquery #}

      <li class="metric-detail">
         <span class="badge-container">
            <span
                  class="ti-badge lil-badge {{metric.award.audience}} {{metric.award.engagementType}}"
                  ng-show="!metric.award.isHighly"
                  popover-trigger="mouseenter"
                  popover-placement="bottom"
                  popover-title="{{metric.award.engagementType}} by {{metric.award.displayAudience}}"
                  popover="This item has {{metric.actualCount}} {{metric.environment}}
                  {{metric.displayInteraction}}, suggesting it's been
                  {{metric.award.engagementType}} by {{metric.award.displayAudience}}.">
               <span class="engagement-type">{{metric.award.engagementType}}</span>
               <span class="audience">by {{metric.award.audience}}</span>
             </span>

            <span
                  class="ti-badge big-badge {{metric.award.audience}} {{metric.award.engagementType}}"
                  ng-show="metric.award.isHighly"
                  popover-trigger="mouseenter"
                  popover-placement="bottom"
                  popover-title="Highly {{metric.award.engagementType}} by {{metric.award.displayAudience}}"
                  popover="This item has {{metric.actualCount}} {{metric.environment}}
                  {{metric.displayInteraction}}. That's better than
                  {{metric.percentiles.CI95_lower}}% of items
                  {{metric.referenceSetStorageVerb}} {{metric.refSet}} in {{metric.referenceSetYear}},
                  suggesting it's highly {{metric.award.engagementType}} by {{metric.award.displayAudience }}.">
               <span class="modifier">highly</span>
               <span class="engagement-type">{{metric.award.engagementType}}</span>
               <span class="audience">by {{metric.award.audience}}</span>
            </span>

         </span>
         <span class="text">
            <a class="value-and-name"
               href="{{ metric.provenance_url }}"
               target="_blank"
               popover-trigger='mouseenter'
               popover-placement="bottom"
               popover="{{ metric.static_meta.description }}. Click to see more details on {{ metric.environment }}.">
               <img ng-src="{{ metric.static_meta.icon }}">
               <span class="raw-value">{{ metric.actualCount }}</span>
               <span class="environment">{{ metric.environment }}</span>
               <span class="interaction">{{ metric.displayInteraction }}</span>
               <i class="icon-external-link-sign"></i>
            </a>

            {% if metric.percentiles %}
            <span class="percentile">
               <span class="values">
                  <span class="lower">{{ metric.percentiles.CI95_lower }}</span>
                  <span class="dash">-</span>
                  <span class="upper">{{ metric.percentiles.CI95_upper }}</span>
                  <span class="unit">percentile</span>

{#                  @todo make the details model open when you click the info icon... #}

                  <i class="icon-info-sign"></i>
               </span>
               <span class="descr">of {{ biblio.genre }}s published in {{ biblio.year }}</span>
            </span>
            {% endif %}

         </span>

      </li>

      {% endfor %}
   </ul>


</div>
